<div id="toolbar" v-if="recipient">
  <div class="circle-container">
    <UiUserState
      :user="user"
      v-if="!server || $device.isMobile"
      :clickHandler="openProfile"
    />
    <UiCircle
      :type="src ? 'image' : 'random'"
      data-cy="friend-chat-circle"
      :seed="`${server ? server.address : '0xdf9eb223bafbe5c5271415c75aecd68c21fe3d7f'}`"
      :source="src"
      @click="openProfile"
      v-if="!$device.isMobile && recipient.type !== 'group'"
    />
    <GroupIcon v-else-if="recipient.type === 'group'" :group="recipient" />
  </div>
  <div class="user-info">
    <TypographyTitle :size="6" :text="recipient.name" />
    <TypographySubtitle
      v-if="!$device.isMobile"
      :size="6"
      :text="recipient.type === 'group' ? `Members: ${group && group.members && group.members.length}` : user.status || ''"
    />
  </div>
  <div class="controls">
    <div
      class="toggle-alerts has-tooltip has-tooltip-bottom has-tooltip-primary has-tooltip-hidden-touch"
      @click="toggleAlerts"
    >
      <UiCircle
        v-if="allUnseenNotifications.length"
        class="notification-alert"
        :size="15"
        color="red"
        type="icon"
        :data="allUnseenNotifications.length"
      >
        {{allUnseenNotifications.length}}
      </UiCircle>
      <bell-icon
        size="1x"
        :class="`control-icon ${showAlerts ? 'primary' : ''}`"
        color="primary"
      />
    </div>

    <UiFloatingContainer
      v-if="showAlerts"
      :offsets="showSidebar ? [4.2] : [4.2, 2.3]"
      heading="Alerts"
      :width="25"
      :height="25"
      :class="`has-tooltip-hidden-touch alerts-floating-container ${showSidebar ? 'side-open' : ''}`"
      :customStyles="$device.isMobile"
      :toggleMethod="() => $data.showAlerts = false"
    >
      <ToolbarAlerts />
    </UiFloatingContainer>
    <template v-if="conversation.type === 'friend'">
      <div
        :class="`has-tooltip has-tooltip-bottom has-tooltip-primary has-tooltip-hidden-touch control-button
        ${!enableRTC || webrtc.activeCall ? 'disabled' : ''}`"
        data-cy="toolbar-enable-audio"
        :data-tooltip="enableRTC ? $t('controls.call') : $t('controls.not_connected')"
        v-if="server"
        @click="handleCall"
      >
        <phone-call-icon size="1x" class="control-icon" />
      </div>
    </template>
    <template v-else>
      <UiComingSoon
        v-if="!$device.isMobile"
        :tooltipText="$t('coming_soon.group_call')"
        :tooltipPosition="'bottom'"
        data-cy="toolbar-enable-audio"
      >
        <div
          :class="`has-tooltip has-tooltip-bottom has-tooltip-primary has-tooltip-hidden-touch control-button
          ${!enableRTC || webrtc.activeCall ? 'disabled' : ''}`"
          :data-tooltip="enableRTC ? $t('controls.call') : $t('controls.not_connected')"
          v-if="server"
          @click="handleCall"
        >
          <phone-call-icon size="1x" class="control-icon" color="grey" />
        </div>
      </UiComingSoon>
    </template>
    <!-- <div
      :class="`has-tooltip has-tooltip-bottom has-tooltip-primary has-tooltip-hidden-touch control-button
      ${!enableRTC || webrtc.activeCall ? 'disabled' : ''}`"
      data-cy="toolbar-enable-video"
      :data-tooltip="enableRTC ? $t('controls.video') : $t('controls.not_connected')"
      v-if="server"
      @click="() => call(['audio', 'video'])"
    >
      <video-icon size="1x" class="control-icon" />
    </div> -->
    <UiComingSoon
      v-if="!$device.isMobile"
      :tooltipText="$t('coming_soon.archived')"
      :tooltipPosition="'bottom'"
      data-cy="toolbar-archived-messages"
    >
      <div
        class="has-tooltip has-tooltip-bottom has-tooltip-primary has-tooltip-hidden-touch"
        :class="ui.showPinned ? 'primary' : ''"
        data-tooltip="Archived Messages"
        @click="() => {
        $store.commit('ui/togglePinned', !ui.showPinned)
      }"
      >
        <archive-icon size="1x" class="control-icon" color="grey" />
      </div>
    </UiComingSoon>
    <div
      v-if="!isGroup(recipient)"
      class="has-tooltip has-tooltip-bottom has-tooltip-primary control-button"
      data-cy="toolbar-new-group"
      :data-tooltip="$t('pages.chat.new_group')"
      @click="toggleModal('creategroup')"
    >
      <users-icon size="1x" class="control-icon" />
    </div>
    <div
      v-else
      class="has-tooltip has-tooltip-bottom has-tooltip-primary control-button"
      :data-tooltip="$t('pages.chat.add_member')"
      @click="groupInvite(getGroup())"
    >
      <user-plus-icon size="1x" class="control-icon" />
    </div>
    <GroupCreate v-click-outside="()=>toggleModal('creategroup')" />
    <GroupInvite v-click-outside="()=>toggleModal('groupInvite')" />

    <div class="vertical-divider" v-if="!$device.isMobile"></div>
    <div
      v-if="!$device.isMobile"
      class="market-place has-tooltip has-tooltip-primary has-tooltip-bottom control-button"
      @click="() => toggleModal(ModalWindows.CALL_TO_ACTION)"
      data-tooltip="Marketplace"
      data-cy="toolbar-marketplace"
    >
      <shopping-bag-icon class="control-icon" size="1x" />
    </div>
    <UiComingSoon
      v-if="!$device.isMobile"
      :tooltipText="$t('coming_soon.wallet')"
      :tooltipPosition="'bottom'"
      data-cy="toolbar-wallet"
    >
      <div
        class="has-tooltip has-tooltip-primary has-tooltip-bottom"
        @click="() => toggleModal(ModalWindows.WALLET)"
        data-tooltip="Wallet"
      >
        <wallet-icon class="control-icon" size="1x" color="grey" />
      </div>
    </UiComingSoon>

    <div class="vertical-divider" v-if="!$device.isMobile"></div>
    <SearchInput
      v-if="!$device.isMobile"
      @search="handleSearch"
      @change="handleChange"
      :placeholder="$t('search.search')"
      :searchRecommend="searchRecommend"
    />
    <SearchResult
      v-if="!$device.isMobile && searchQuery"
      :searchQuery="searchQuery"
      :user="user"
      @toggle="toggleSearchResult"
    />
    <ToolbarPinned v-if="ui.showPinned" />
  </div>
</div>
