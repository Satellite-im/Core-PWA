<div
  class="is-message"
  :class="iridium.messageLoading ? 'loading' : ''"
  @contextmenu="contextMenu"
>
  <div
    :class="`message-container ${message.pinned ? 'pinned-message' : ''}`"
    data-cy="message-container"
  >
    <div v-if="message.pinned" class="pinned-badge">
      <archive-icon size="0.85x" />
      Archived
    </div>
    <MessageActions
      v-if="!hideActions && !messageEdit"
      :setReplyChatbarContent="setReplyChatbarContent"
      :emojiReaction="emojiReaction"
      :editMessage="editMessage"
      :message="message"
    />
    <template v-if="!messageEdit && message.type === 'direct'">
      <MessageMarkdown
        :text="wrapEmoji(markdownToHtml(message.body))"
        :class="`markdown ${containsOnlyEmoji(message.body) ? 'bigmoji' : ''}`"
        :data-cy="`chat-message`"
      />
      <span class="status editing" v-if="message.editingAt">
        <UiLoadersSpinner spinning />
      </span>
      <span
      class="status edited"
      data-cy="message-edited"
      v-else-if="message.editedAt"
    >
      ({{$t('ui.edited')}})
    </span>
    </template>
    <MessageGlyph
      v-if="message.type === 'glyph'"
      :source="message.body"
      :pack="message.pack"
    />
    <!-- Only for video types we can't embed directly without doing something sketchy, like sending it to a server somewhere to extract the HTML5 video-->
    <UiChatEmbedsEmbeddedLinkContent
      v-if="message.type === 'direct'"
      :data="message.body"
    />
    <UiChatEmbedsVideoPlayer
      v-else-if="message.type === 'video'"
      :data="message.body"
    />
    <UiChatEmbedsAudioPlayer
      v-else-if="message.type === 'audio'"
      :data="message.body"
    />
    <UiChatEmbedsFile
      v-else-if="message.type === 'file'"
      :file="message.body"
    />
    <MessageReactions
      v-if="!hideActions && hasReactions"
      :message="this.$props.message"
      :group="this.$props.group"
      :key="`${this.$props.message.id}-${hasReactions ? this.$props.message.reactions.length : 0}`"
    />
  </div>
  <MessageReply
    :message="message"
    :group="group"
    v-if="!hideActions"
    :from="from"
  />
  <MessageEdit
    v-if="messageEdit"
    :message="message.body"
    @commitMessage="saveMessage"
    @cancelMessage="cancelMessage"
  />
</div>
