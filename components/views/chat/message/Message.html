<div class="chat-message-container" :class="{ 'show-header': showHeader }">
  <MessageNotice v-if="isNotice" :message="message" />
  <div
    v-else
    class="chat-message"
    :class="{ 'show-header': showHeader, 'is-replying-to': isReplyingTo, 'is-editing': isEditing }"
  >
    <!-- todo - add user options context menu -->
    <template v-if="showHeader">
      <div class="avatar">
        <UiCircle
          :type="avatarSrc ? 'image' : 'random'"
          :seed="author.did"
          :source="avatarSrc"
        />
      </div>
      <div class="header">
        <TypographyText as="h4"> {{ author.name }} </TypographyText>
      </div>
    </template>
    <!-- todo end -->
    <div v-if="message.type !== 'call'" class="timestamp">{{ timestamp }}</div>
    <UiContextMenu class="body" :items="contextMenuValues">
      <MessageMarkdown
        v-if="message.body && !isEditing"
        :text="markdownToHtml"
        class="markdown"
        :class="{ bigmoji: containsOnlyEmoji }"
        data-cy="chat-message"
      />
      <MessageEdit
        v-if="isEditing"
        :message="message"
        @commitMessage="saveMessage"
        @cancelMessage="cancelMessage"
      />
      <span
        v-else-if="message.lastEditedAt"
        class="status edited"
        data-cy="message-edited"
      >
        ({{$t('ui.edited')}})
      </span>
      <MessageGlyph v-else-if="message.glyph" :glyph="message.glyph" />
      <MessageActions
        v-if="message.type !== 'call'"
        :setReplyChatbarMessage="setReplyChatbarMessage"
        :emojiReaction="emojiReaction"
        :editMessage="editMessage"
        :message="message"
        :hideReply="hideReplyAction"
      />
    </UiContextMenu>
    <MessageCallDirection
      v-if="message.type === 'call'"
      :message="message"
      :isLastCallMessage="item.isLastCallMessage"
    />
    <MessageCall
      v-if="message.type === 'call'"
      :message="message"
      :isLastCallMessage="item.isLastCallMessage"
    />
    <MessageAttachments
      v-if="message.attachments.length"
      class="attachments"
      :attachments="message.attachments"
    />
    <div class="footer">
      <MessageReactions :message="message" :emojiReaction="emojiReaction" />
      <MessageReplies :replies="replies" v-if="replies?.length" />
    </div>
  </div>
</div>
